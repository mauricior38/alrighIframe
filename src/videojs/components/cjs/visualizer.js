/**
 * @license
 * Copyright (c) 2023 The Nuevodevel Team. All rights reserved.
 * Audio Visualizer Plugin for Video.js v7
 */
/*eslint no-inner-declarations: "off"*//* eslint-env node */function _interopDefault(e){return e&&"object"===typeof e&&"default"in e?e.default:e}var videojs=_interopDefault(require("video.js"));var defaults={video:!1,color1:"#ffcc00",color2:"#ff0000",capsColor:"#fff",caps:!1,bottom:0,width:50,height:50,f_play:!1};const registerPlugin=videojs.registerPlugin||videojs.plugin,onPlayerReady=(e,i)=>{var t=videojs.browser.IS_IPHONE,o=videojs.browser.IS_POD,n=i,r=function(){if("undefined"!==typeof window){window.AudioContext=window.AudioContext||window.webkitAudioContext;if(window.AudioContext)return!0;else return!1}};if(r()&&!0!==t&&!0!==o){var a,l,d,s,f,c,u,h,w=!0,v=new WeakMap(),m=50,p=0;if(i.height>0&&i.height<=100)m=i.height;if(i.bottom>0)p=i.bottom+"%";var g=".vjs-visualizer{position:absolute;left:0;padding:0 10px;bottom:"+p+";width:100%;height:"+m+"%;pointer-events:none;}",y=document.head||document.getElementsByTagName("head")[0],A=document.createElement("style");A.type="text/css";A.appendChild(document.createTextNode(g));y.appendChild(A);d=document.createElement("canvas");d.className="vjs-visualizer";d.id="visualizer";e.el().insertBefore(d,e.controlBar.el_);e.on("loadeddata",function(){a=!1;var i=e.currentType();console.log("TYPE:"+i);if(i.indexOf("audio")>-1)a=!0;else a=!1;n.f_play=!1;if(n.video)a=!0});function R(){var i=e.$(".vjs-tech");try{if(void 0===l)l=new AudioContext();if(v.has(i))u=v.get(i);else{u=l.createMediaElementSource(i);v.set(i,u)}h=l.createAnalyser();d.width=d.offsetWidth;d.height=e.el().offsetHeight;c=d.getContext("2d");u.connect(h);h.connect(l.destination)}catch(e){}}e.on("playing",function(){if(!n.f_play){var i=e.currentSource();if(void 0!==i.av)w=!1;var t=e.el().querySelector(".vjs-background-bar");n.f_play=!0;if(a&&w&&t){R();function o(e,i){e=e.replace("#","");var t=parseInt(3===e.length?e.slice(0,1).repeat(2):e.slice(0,2),16),o=parseInt(3===e.length?e.slice(1,2).repeat(2):e.slice(2,4),16),n=parseInt(3===e.length?e.slice(2,3).repeat(2):e.slice(4,6),16);if(i)return"rgba("+t+", "+o+", "+n+", "+i+")";else return"rgb("+t+", "+o+", "+n+")"}if(n.color1.indexOf("#")<0)n.color1="#"+n.color1;if(n.color2.indexOf("#")<0)n.color2="#"+n.color2;var r="#ffcc00",l="#ff0000",u="#fff",v=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i;if(v.test(n.capsColor))u=n.capsColor;if(v.test(n.color1))r=n.color1;if(v.test(n.color2))l=n.color2;var m=o(r),p=o(l),g=o(r,.2),y=[];function A(){if(a){var i=e.$(".vjs-tech");if("VIDEO"===i.nodeName){var t=e.el().querySelector(".vjs-background-bar");if(t)t.style.height="10%"}h.fftSize=256;s=h.frequencyBinCount;d.width=e.el().offsetWidth-20;var o=d.width/s*1.2;if(o<6)o=6;var r,l=1;if(d.width<500)l=2;if("undefined"!==typeof window)window.RequestAnimationFrame=window.requestAnimationFrame(A)||window.msRequestAnimationFrame(A)||window.mozRequestAnimationFrame(A)||window.webkitRequestAnimationFrame(A);var w=0;f=new Uint8Array(s);h.getByteFrequencyData(f);c.clearRect(0,0,d.width,d.height);for(var v=0;v<s;v+=l){v=parseInt(v,10);r=f[v];if(w+o<d.width){var R=c.createLinearGradient(0,0,0,.5*d.height);R.addColorStop(1,m);R.addColorStop(.5,p);R.addColorStop(0,p);var b=d.height/1.5-r,C=d.height/1.5;c.fillStyle=R;c.fillRect(w,b,o,r);if(n.caps)if(y[w]){c.fillStyle=u;if(b<y[w]){y[w]=b;if(b!==C)c.fillRect(w,b-6,o,3)}else{y[w]=y[w]+1;if(y[w]<C)c.fillRect(w,y[w]-6,o,3)}}else y[w]=b;c.fillStyle=g;c.fillRect(w,d.height/1.5,o,r/2);w+=o+4}}}else try{c.clearRect(0,0,d.width,d.height)}catch(e){}}if("undefined"!==typeof window)window.RequestAnimationFrame=window.requestAnimationFrame(A)||window.msRequestAnimationFrame(A)||window.mozRequestAnimationFrame(A)||window.webkitRequestAnimationFrame(A)}}})}},visualizer=function(e){this.ready(()=>{onPlayerReady(this,videojs.mergeOptions(defaults,e))})};registerPlugin("visualizer",visualizer);visualizer.VERSION="1.0";module.exports = visualizer;
