/**
 * @license
 * Copyright (c) 2023 The Nuevodevel Team. All rights reserved.
 * UpNext Plugin for Video.js v7
 */
/*eslint no-inner-declarations: "off"*//* eslint-env node */function _interopDefault(e){return e&&"object"===typeof e&&"default"in e?e.default:e}var videojs=_interopDefault(require("video.js"));function factory(e,i,n){var l={nextTitle:"Up Next",offset:30},t=videojs.mergeOptions||videojs.util.mergeOptions;n=t(l,n||{});var a,r,s,d,o,v=!1,c=!1,f=n.nextTitle,u=n.offset,p=0;if(i){var h=function(e,i,n){var l=document.createElement(e);if(i)l.className=i;if(n)l.innerHTML=n;return l};e.upnext.title=function(e){if(e.length>1)f=e};e.upnext.offset=function(e){if(parseInt(e,10)>0)u=e};if(!N(i))if("undefined"!==i.title&&("undefined"!==i.sources||"undefined"!==i.nextURL)&&"undefined"!==i.poster){var m=[];m[0]=i;i=m}if(N(i)){for(var g=[],j=0;j<i.length;j++)if(i[j].title&&(i[j].sources||i[j].nextURL)&&i[j].poster){g.push(i[j]);var C=h("img");C.src=i[j].poster;i[j].img=C}if(g.length>1){r=g[1];p=1}else r=g[0];var x=null,y=null,k=null,b=null;if(0!==g.length){videojs.dom.addClass(e.el(),"vjs-up-next");e.on("timeupdate",function(){if(!videojs.dom.hasClass(e.el(),"vjs-ad-playing")&&!videojs.dom.hasClass(e.el(),"vjs-dai"))if(!(g.length<1))if(!(g.length>1&&p===g.length-1))if(!L()){if(!0!==v&&e.currentTime()>0&&e.duration()-e.currentTime()<u)A();if(v&&e.duration()-e.currentTime()>u){if(x){x.onclick=null;x.parentNode.removeChild(x);x=null}v=!1}}});e.on("ended",function(){if(!videojs.dom.hasClass(e.el(),"vjs-ad-playing")&&!videojs.dom.hasClass(e.el(),"vjs-dai"))T()});var I=function i(){if(x){x.onclick=null;x.parentNode.removeChild(x)}if(y){y.onclick=null;y.parentNode.removeChild(y)}clearInterval(s);e.off("dispose",i)};e.on("dispose",I)}}else console.log("Error: Upnext - Invalid list array")}function N(e){return"[object Array]"===Object.prototype.toString.call(e)}function L(){if(e.duration()===1/0)return!0;else if("8"===videojs.browser.IOS_VERSION&&0===e.duration())return!0;return!1}function A(){if(!v)if(!c){x=h("div","vjs-upnext");var i=r.img;i.setAttribute("alt",r.title);x.appendChild(i);if(r.duration){var n=h("div","next-dur",r.duration);x.appendChild(n)}var l=h("span","upnext-right",'<span class="nextup">'+f+'</span><span class="vjs-up-title">'+r.title+"</span>");x.appendChild(l);if(r.nextURL){var t=h("a");t.href=r.nextURL;t.target="_blank";if(r.target){var a=r.target;if("_self"===a||"_blank"===a)t.target=a}t.onclick=function(){e.pause()};x.appendChild(t)}e.el().appendChild(x);setTimeout(()=>{x.className="vjs-upnext vjs-upnext-show"},500);v=!0;x.onclick=function(){if(g[0].nextURL){e.pause();if(t)t.click()}else{e.changeSource(r);x.onclick=null;e.el().removeChild(x);x=null;e.play();if(1===g.length){c=!0;videojs.dom.removeClass(e.el(),"vjs-up-next");g.splice(0,1)}else if(p<g.length-1){p++;r=g[p]}}}}}function T(){if(0!==g.length){videojs.dom.addClass(e.controlBar.el_,"vjs-hidden");videojs.dom.addClass(e.el(),"vjs-up-next");if(1===g.length)c=!0;if(x){x.onclick=null;x.parentNode.removeChild(x);x=null}k=h("div","vjs-nextup");var i=h("div","next-close");i.innerHTML="x";k.appendChild(i);var n=h("div","next-header","<span>Up Next</span>");k.appendChild(n);y=h("div","vjs-fullnext");k.appendChild(y);var l=h("div","respo");d=h("div","img");d.style.backgroundImage="url("+r.poster+")";l.appendChild(d);y.appendChild(l);if(r.duration){var t=h("div","full-dur",r.duration);y.appendChild(t)}var s=h("div","next-title",r.title);y.appendChild(s);if(1===g.length)if(r.nextURL){o=h("a");o.href=r.nextURL;if(r.target)o.target=r.target;else o.target="_blank";y.appendChild(o)}var v,f=h("div","progress");f.innerHTML='<svg viewBox="0 0 84 84" preserveAspectRatio="xMinYMin meet"><circle class="circle1" cx="40" cy="40" r="40"></circle><circle id="circle2" class="circle2" cx="40" cy="40" r="40"></circle><g style="transform: translate(77%,26%) rotate(90deg) scale(3, 3);fill: #fff;"><path d="M3 12.2V3.8c0-.8.8-1.3 1.5-.9l7.1 4.2c.6.4.6 1.3 0 1.7L4.5 13c-.7.5-1.5 0-1.5-.8z"></path></g></svg>';y.appendChild(f);l.onclick=function(){if(1===g.length&&o)o.click();else{r=g[p];A()}};i.onclick=function(){clearInterval(u);y.onclick=null;if(k){k.parentNode.removeChild(k);k=null}if(b){b.parentNode.removeChild(b);b=null}e.play();e.one("playing",function(){videojs.dom.removeClass(e.el(),"vjs-up-next");videojs.dom.removeClass(e.controlBar.el_,"vjs-hidden");c=!0;if(1===g.length){c=!0;g.splice(0,1);r=null}})};b=h("div","next-overlay");var u,m=2*Math.PI*170;e.el().appendChild(b);e.el().appendChild(k);if(g.length>1){var j="vjs-nav-prev",C="vjs-nav-next";if(0===p)j="vjs-nav-prev disabled";if(p===g.length-1)C="vjs-nav-next disabled";var I=h("div",j,'<div class="icon"></div>'),N=h("div",C,'<div class="icon"></div>');b.appendChild(I);b.appendChild(N);N.onclick=function(){p++;if(!(p>g.length-1)){if(p===g.length-1)videojs.dom.addClass(N,"disabled");videojs.dom.removeClass(I,"disabled");clearInterval(u);if(v)v.removeAttribute("stroke-dasharray");L(p,"next")}else p=g.length-1};I.onclick=function(){p--;if(!(p<0)){clearInterval(u);if(v)v.removeAttribute("stroke-dasharray");if(0===p)videojs.dom.addClass(I,"disabled");videojs.dom.removeClass(N,"disabled");L(p,"prev")}else p=0};function L(e,i){var n=h("div","img");n.style.backgroundImage="url("+g[e].poster+")";if("next"===i)n.style.left="100%";else n.style.left="-100%";var a,r=100,o=-100;l.appendChild(n);function v(){r-=3;if(!(r<=0)){if(r>0)n.style.left=r+"%";a=requestAnimationFrame(v)}else{cancelAnimationFrame(a);n.style.left=0;d.parentNode.removeChild(d);d=n;n=null}}function c(){o+=3;if(!(o>=0)){if(o<0)n.style.left=o+"%";a=requestAnimationFrame(c)}else{cancelAnimationFrame(a);n.style.left=0;d.parentNode.removeChild(d);d=n;n=null}}if("next"===i)a=requestAnimationFrame(v);else a=requestAnimationFrame(c);s.innerHTML=g[e].title;if(g[e].duration&&t){t.innerHTML=g[e].duration;videojs.dom.removeClass(t,"vjs-hidden")}else if(t)videojs.dom.addClass(t,"vjs-hidden")}}a=0;if(p!==g.length-1||1===g.length)u=setInterval(function(){v=document.getElementById("circle2");if(a<.25){v.setAttribute("stroke-dasharray",m*a+" "+m*(1-a));a+=.001}else{clearInterval(u);if(1===g.length&&o)o.click();else A()}},25)}function A(){clearInterval(u);y.onclick=null;if(k){k.parentNode.removeChild(k);k=null}if(b){b.parentNode.removeChild(b);b=null}e.changeSource(r);e.play();e.one("playing",function(){videojs.dom.removeClass(e.el(),"vjs-up-next");videojs.dom.removeClass(e.controlBar.el_,"vjs-hidden");if(1===g.length){c=!0;g.splice(0,1);r=null}});if(g.length>1)if(p<g.length-1){p++;r=g[p]}}}}var registerPlugin=videojs.registerPlugin||videojs.plugin,plugin=function(e,i){this.ready(function(){factory(this,e,i)})};registerPlugin("upnext",plugin);module.exports = plugin;
